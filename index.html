<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Indonesia - Health MSRP</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

    <!-- Custom styles for this template -->
    
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
   integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
   crossorigin=""/>

   <link href="style.css" rel="stylesheet">


   <style>
   	#loadinggif{
	  position: fixed;
	  z-index: 9000;
	  top: 0;
	  left: 0;
	  width: 100vw;
	  height: 100vh;
	  background: rgba(0,0,0,.4);
	  text-align: center;
	  padding-top: 45vh;
	  display: none;
	}
	#loadinggif img{
		width: 100px;
	}
    .google-visualization-table-th{
        color: rgba(0,0,0,.8);
    }
    #datatable th{
        background :#1b9d93;
    }
    .table-striped tbody tr:nth-of-type(odd) {
        background-color: #fafafa;
    }



   </style>
  </head>

  <body>
    <!-- HEADER -->
	<div class="container-fluid p-0 mx-0">    
        <div id="blockhead" class="d-flex flex-column flex-md-row align-items-center py-3 px-0 mb-3 bg-white border-bottom shadow-sm">
            <div class="container">
                <div class="fa fa-stethoscope float-left" style="color:#6CDBC7; font-size: 2.3rem; margin-right: 1rem"></div>	  
                <h3 class="my-0 mr-md-auto font-weight-bold float-left">Health</h3>
                <div class="float-right">
                    <a target="_blank" href="https://data.humdata.org">
                        <img style="height: 17px" class="img-responsive hdx" src='images/HDX-logo-home.svg'>
                    </a>
                </div>
                <div class="float-right">Powered by &nbsp;</div>
                
            </div>
        </div>  
    </div>
    <!-- END HEADER -->

   	<div class="container">
  	    <div id="loadinggif"><img src="./images/hdx-loading.gif"></div>
    </div>
  	

    <!-- START Page Content -->
    <div class="container" id='maincontainer'>
    	<div class="row">
        	<!-- CENTER PANEL -->
            <div class="col-md-12 apanel mb-3">
                <div class="row">
                    <div class="row blockrow">
                        <div class="col-md-12" style="text-align: left;">
                            <p class="pmap text-justify">Activities that are mostly carried out have been supporting health care facilities with PPE. Most activities are carried out at national level, in Java Island and Central Sulawesi, however on-line activities have been participated by the health offices and other health partners in regions.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12 apanel">
                <div class="row">
                    <div class="col-md-12 p-0">
                        <div id='regions_div' style="margin-bottom: 20px;"></div>
                    </div>
                </div>
            </div>
			<div class="col-md-12 p-0">
				<div class="row">
					<div class="col-md-4">
						<div class="col-md-12 paneltitle">
						<div id="val1" class="thevaluedata"></div>
							<font class="panelTitleVal">Organizations</font>
						</div>
					</div>
					<div class="col-md-4">
						<div class="col-md-12 paneltitle">
						<div id="val2" class="thevaluedata"></div>
							</font><font class="panelTitleVal">Activities</font>
						</div>
					</div>
					<div class="col-md-4">
						<div class="col-md-12 paneltitle">
						<div id="val3" class="thevaluedata"></div>
							</font><font class="panelTitleVal">Locations</font>
						</div>
					</div>
				</div>
            </div>
            <div class="col-12 mt-3 mb-3">
                <div class="row">
                    <div class="col-12 p-0" id="Indicator"></div>
                </div>
            </div>
			<div class="col-md-12 p-0">
				<div class="row">
					<div class="col-md-12 p-0">
						<div class="row">
							<div class="col-md-4">
								<div class="col-md-12 paneltitle" style="margin-top: 1rem">
									<font class="panelTitleBold">Type of Activities</font>
								</div>
								<div id="pieOrg"></div>
							</div>
							<div class="col-md-4">
								<div class="col-md-12 paneltitle" style="margin-top: 1rem">
									<font class="panelTitleBold">Activity &nbsp; Status &nbsp;</font>
								</div>
								<div id="pieStat"></div>
							</div>
							<div class="col-md-4">
								<div class="col-md-12 paneltitle" style="margin-top: 1rem">
									<font class="panelTitleBold">Type of Beneficiaries</font>
								</div>
								<div id="pieBene"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-12">
				<div class="row">
					<div class="col-md-6 mt-5">
                        <div class="col-md-12 paneltitle" style="margin-top: 1rem">
                            <font class="panelTitleBold">Total of Agency Activities</font>
                        </div>
						<div id="bubblechart"></div>
                    </div>
                    <div class="col-md-6 mt-5">
                        <div class="col-md-12 paneltitle" style="margin-top: 1rem">
                            <font class="panelTitleBold">Total Sub priority Area</font>
                        </div>
						<div id="barSect"></div>
					</div>
				</div>
			</div>
    		<div class="col-md-12 order-md-4">
                <div class="row">
    			    <p class="pmap">The information is based on the latest compilation of reports by OCHA Indonesia. Listed activities are only taken from the reports that include minimum information that can be mapped. This will be updated fortnightly.</p>
                </div>
                <div class="col-md-12 apanel p-0 mt-3">
	    			<div class="row">
		    			<div class="col-md-12 p-0">
		    				<table id="datatable" class="table table-striped table-bordered table-hover" style= 'width:100%; overflow-y: scroll'></table>
		    			</div>
		    		</div>
	    		</div>
	    	</div>
	    	<footer>
                <!-- <div style="font-size: 12px; padding-right: 30px; padding-top: 10px">
                	<table style="float: right;">
                		<tr>
                			<td>Powered by &nbsp;</td>
                			<td>
                				<a target="_blank" href="https://data.humdata.org">
			                		<img style="height: 17px" class="img-responsive hdx" src='images/HDX-logo-home.svg'>
			                	</a>
                			</td>
                		</tr>
                	</table>
                </div> -->
            </footer> 
        </div>
    </div>
    <!-- END Page Content -->
    <br/><br/>


    <!-- JAVASCRIPT LIBRARY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.14.2/d3.min.js" integrity="sha512-q+YfJkQKsLllP2SGvUeY/vaHecjC35Jv3GOJNmy533ZsVdbf+X0ykzCMrBBzu5HH20nztPWGClDG++XFa0Iniw==" crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script type="text/javascript" src=" https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
   
    

    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
   integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
   crossorigin=""></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>

   

    <script type="text/javascript">
    	$(document).ready(function(){

    		// INITIAL VARIABLE
    		var thedata,
    			theDataTableInit = 0,
    			human_number = d3.format(",d"),
    			SelectedRegion = 'Province',
    			statesData = 0,
				reportingperiod = [],
    			provinceCount = [],
    			agenciesCount = [],
    			statusCount = [],
				beneCount = [],
    			sectorCount = [],
    			orgtotal = 0,
    			zero = 0;
    			regionselect = 0;


			var geojson;
			var map = L.map('regions_div', { //map is a global variable
			    center: [-2.03618339014499954, 117.92711693632814],
			    zoom:4.9,
			    zoomDelta: 0.5,
		            zoomSnap: 0,
			    zoomControl: false,
			    layerControl:false,
			    attributionControl: true,
			    minZoom: 4,
			    maxZoom: 15,
			});
			var CartoDB_Positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'

			});

			CartoDB_Positron.addTo(map);


			function drawboundaries(){
				d3.json('indonesia-adm-1.geojson',function(jso){	
	    			// var statesData = jso;
	    			// get color depending on population density value
					function style(feature) {
						return {
							weight: 1,
							opacity: 1,
							color: 'grey',
							fillColor: 'transparent',
							className: 'countriesboundaries'
						};
					}
					var geojson;
					geojson = L.geoJson(jso, {
						style: style,
					}).addTo(map);
	    		})
			}
			

			function drawMapCircle(){
				d3.csv('data/center-point_province.csv').then(function(cp){
					cp.forEach(function(d,i){
						let nmprv = d['Features Properties Provinsi'].toUpperCase();
						if(provinceCount[nmprv]){
							let act = 'activity';
							if(provinceCount[nmprv] > 1){
								act = 'activities';
							}
							let radius = provinceCount[nmprv];
							if(radius < 5){
								radius = 5;
							}
							L.circleMarker([d['Latitude'],d['Longitude']],{
								radius: radius,
								fill: '#20BFB3',
								weight: 1,
								fillOpacity: 0.4,
								color: '#20BFB3',
							}).bindPopup("<b>"+nmprv+"</b>: "+provinceCount[nmprv]+" "+act)
							.on('mouseover',function(){ this.openPopup(); })
							.on('mouseout',function(){ this.closePopup(); })
							.addTo(map)
						}
					})
				})
				
			}

    		// function to draw the map
    		function drawregiondiv(){
    			
    			// control that shows state info on hover
				var info = L.control();

				info.onAdd = function (map) {
					this._div = L.DomUtil.create('div', 'info');
					this.update();
					return this._div;
				};

				info.update = function (props) {
					// if(props){
					// 	console.log(provinceCount,props.Province);
					// }
					
					this._div.innerHTML = '<h6>Organisation Activities by Province</h6>' +  (props ?
						'<b>' + props.PROVINSI + '</b><br />' + provinceCount[props.PROVINSI.toUpperCase()] + ' Activities'
						: 'Hover over a state');
				};

				info.addTo(map);


				// get color depending on population density value
				function getColor(d) {
					// return 	d > 50  ? '#157A72' :
					// 		d > 20  ? '#1B9D93' :
					// 		d > 10  ? '#20BFB3' :
					// 		d > 5   ? '#48CAC0' :
					// 		d > 1   ? '#85DCD5' :
					// 					'transparent';

					return 	d >= 1   ? '#070707' : 'transparent'
				}
				function style(feature) {
					return {
						weight: 0.5,
						opacity: 1,
						color: getColor(provinceCount[feature.properties.PROVINSI.toUpperCase()]),
						dashArray: '1',
						fillOpacity: 0,
						// fillColor: getColor(provinceCount[feature.properties.PROVINSI.toUpperCase()])
					};
				}

				function highlightFeature(e) {
					var layer = e.target;

					layer.setStyle({
						weight: 0.8,
						color: getColor(provinceCount[layer.feature.properties.PROVINSI.toUpperCase()]),
						dashArray: '0',
						fillOpacity: 0
					});

					if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
						// layer.bringToFront();
					}

					info.update(layer.feature.properties);
				}


				function resetHighlight(e) {
					geojson.resetStyle(e.target);
					info.update();
				}

				function zoomToFeature(e) {
					// map.fitBounds(e.target.getBounds());
					let kec = e.target.feature.properties.Province;
					let select = kec.replace(' ','-');
					$('#regionselect option').removeAttr('selected').filter('[value=' + select + ']').attr('selected', true);
					redrawvis(kec);
				}

				function onEachFeature(feature, layer) {
					layer.on({
						mouseover: highlightFeature,
						mouseout: resetHighlight,
						click: zoomToFeature
					});
				}

				geojson = L.geoJson(statesData, {
					style: style,
					onEachFeature: onEachFeature
				}).addTo(map);

				//map.attributionControl.addAttribution('The Data &copy; Compile by OCHA and RCO');


				// var legend = L.control({position: 'bottomleft'});

				// legend.onAdd = function (map) {

				// 	var div = L.DomUtil.create('div', 'info legend'),
				// 		grades = [1, 5, 10, 20, 50],
				// 		labels = [],
				// 		from, to;

				// 	for (var i = 0; i < grades.length; i++) {
				// 		from = grades[i];
				// 		to = grades[i + 1];

				// 		labels.push(
				// 			'<i style="background:' + getColor(from + 1) + '"></i> ' +
				// 			from + (to ? '&ndash;' + to : '+'));
				// 	}

				// 	div.innerHTML = labels.join('<br>');
				// 	return div;
				// };

				// legend.addTo(map);
	    	}

	    	function f_drawPieOrg(){
	    		var thedata = [['Type Org', 'Total']];
	    		for(x in agenciesCount){
	    			thedata.push([x,agenciesCount[x]])
	    		}

	    		// Load google charts
				google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback(drawChart);

				// Draw the chart and set the chart values
				function drawChart() {
				  var data = google.visualization.arrayToDataTable(thedata);

				  // Optional; add a title and set the width and height of the chart
				  var options = {
					pieHole: 0.4,
				  	legend: 'none',
				  	padding:'15px',
			        pieSliceText: 'label',
			        pieStartAngle: 100,
			        colors: ['#157A72', '#1B9D93', '#20BFB3', '#48CAC0', '#85DCD5'],
			        chartArea:{
			        	left:'15%',
			        	top:10,
			        	bottom:10,
			        	width:'70%',
			        	height:'60%'
			        }
			      };

				  // Display the chart inside the <div> element with id="piechart"
				  var chart = new google.visualization.PieChart(document.getElementById('pieOrg'));
				  chart.draw(data, options);
				  google.visualization.events.addListener(chart, 'select', function() {
					  var sel = chart.getSelection()[0].row;
					  redrawbaseorg(thedata[sel+1][0]);
				  });
				}
	    	}
				
			function f_drawPieStat(){
	    		var thedata = [['Implementation_period', 'Total']];
	    		for(x in statusCount){
	    			thedata.push([x,statusCount[x]])
	    		}

	    		// Load google charts
				google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback(drawChart);

				// Draw the chart and set the chart values
				function drawChart() {
				  var data = google.visualization.arrayToDataTable(thedata);

				  // Optional; add a title and set the width and height of the chart
				  var options = {
					pieHole: 0.4,
				  	legend: 'none',
			        pieSliceText: 'label',
			        pieStartAngle: 100,
			        colors: ['#20BFB3', '#1B9D93', '#85DCD5'],
			        chartArea:{
			        	left:"15%",
			        	top:10,
			        	bottom:10,
			        	width:'70%',
			        	height:'70%'
			        },
			      };

				  // Display the chart inside the <div> element with id="piechart"
				  var chart = new google.visualization.PieChart(document.getElementById('pieStat'));
				  chart.draw(data, options);
				  google.visualization.events.addListener(chart, 'select', function() {
					  var sel = chart.getSelection()[0].row;
					  redrawbasestat(thedata[sel+1][0]);
				  });
				}
	    	}

			function f_drawPieBene(){
	    		var thedata = [['Type of beneficiaries', 'Total']];
	    		for(x in beneCount){
	    			thedata.push([x,beneCount[x]])
	    		}

	    		// Load google charts
				google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback(drawChart);

				// Draw the chart and set the chart values
				function drawChart() {
				  var data = google.visualization.arrayToDataTable(thedata);

				  // Optional; add a title and set the width and height of the chart
				  var options = {
					pieHole: 0.4,
				  	legend: 'none',
			        pieSliceText: 'label',
			        pieStartAngle: 100,
			        colors: ['#20BFB3', '#1B9D93', '#85DCD5', '#20BFB3'],
			        chartArea:{
			        	left:"15%",
			        	top:10,
			        	bottom:10,
			        	width:'70%',
			        	height:'70%'
			        },
			      };

				  // Display the chart inside the <div> element with id="pieBene"
				  var chart = new google.visualization.PieChart(document.getElementById('pieBene'));
				  chart.draw(data, options);
				  google.visualization.events.addListener(chart, 'select', function() {
					  var sel = chart.getSelection()[0].row;
					  redrawbasestat(thedata[sel+1][0]);
				  });
				}
	    	}		

	    	function f_drawBarSect(){
	    		var head = ['Sub Priority Area', 'Total',{type: 'string', role: 'annotation'}];
	    		var thedata = [];
	    		for(x in sectorCount){
	    			thedata.push([x,sectorCount[x],sectorCount[x]])
	    		}
	    		thedata.sort(sortFunction);

				function sortFunction(a, b) {
				    if (a[1] === b[1]) {
				        return 0;
				    }
				    else {
				        return (a[1] > b[1]) ? -1 : 1;
				    }
				}
				thedata.unshift(head);

	    		google.charts.load('current', {packages: ['corechart', 'bar']});
				google.charts.setOnLoadCallback(drawBasic);

				function drawBasic() {

				      var data = google.visualization.arrayToDataTable(thedata);

				      var options = {
				      	colors:['#20bfb3'],
				      	height:350,
				        chartArea: {width: '80%',top:5,right:0,bottom:40},
				        legend: 'none',
				        
				        hAxis: {
				        // title: 'Total Activities',
							gridlines: {
								color: 'transparent'
							},
							ticks:[],
							minValue: 0
				        },

				        vAxis: {
				          // title: 'Sectors'
				          textStyle:{
				          	fontSize:10
				          }
				        },
				        annotations: {
				          alwaysOutside: true,
				          textStyle: {
				            fontSize: 12,
				            auraColor: 'none',
				            color: '#555'
				          },
				          boxStyle: {
				            stroke: '#ccc',
				            strokeWidth: 1,
				            gradient: {
				              color1: '#f3e5f5',
				              color2: '#f3e5f5',
				              x1: '0%', y1: '0%',
				              x2: '100%', y2: '100%'
				            }
				          }
				        },
				        animation:{
					        duration: 1000,
					        easing: 'out',
					        startup: true
					    },
				      };

				      var chart = new google.visualization.BarChart(document.getElementById('barSect'));

				      chart.draw(data, options);
				      google.visualization.events.addListener(chart, 'select', function() {
						  var sel = chart.getSelection()[0].row;
						  redrawbasesector(thedata[sel+1][0]);
					  });
				    }
	    	}	

			function f_drawIndicator() {
				google.charts.load('current', {'packages':['table']});
				google.charts.setOnLoadCallback(drawTable);

				function drawTable() {
					var data = new google.visualization.DataTable();
					data.addColumn('string', 'Indicator');
					data.addColumn('number', 'Total Report');
					data.addRows([
					['Number of healthcare providers trained in detecting, referral and appropriate management of COVID-19 cases.',  {v: 12, f: '12'}],
					['Number of healthcare facilities staff and community health workers provided with Personal Protective Equipment (PPE).',   {v:14,   f: '14'}],
					['Number of health workers trained on (or health facilities supported on) surveillance, rapid response, MHPSS, and case management.', {v: 32, f: '32'}],
					['Number of healthcare providers trained in detecting, referral and appropriate management of COVID-19 cases.',   {v: 7,  f: '7'}]
					]);

					var table = new google.visualization.Table(document.getElementById('Indicator'));

					table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
				}
			}

	    	// function to draw the data table
	    	function f_drawDataTable(data){
	    		if(theDataTableInit){
	    			theDataTableInit.destroy();
	    		}

	    		var thedatasource = [];
	    		$.each(data,function(i,z){

	    			newdata = [	z['Agency'],
	    						z['Sub Priority Area'],
	    						z['MSRP Indicator'],
	    						z['Type of Activity'],
	    						//z['Type of beneficiaries'],
	    						//z['# of beneficiaries'],
	    						//z['Location'],
	    						z['Province'],
	    						//z['Implementation period (start)'],
	    						z['Implementation_period'],
	    						z['Implementing Partner'],
	    						//z['Remark'],
	    					];
	    			
    				thedatasource.push(newdata);
    			});


	    		theDataTableInit = $('#datatable').DataTable( {
	    			data: thedatasource,
			        columns: [
			            { title: "Agency" },
			            { title: "Sub Priority Area"},
			            { title: "MSRP Indicator" },
			            { title: "Type of Activity" },
			            //{ title: "Type of beneficiaries" },
			            //{ title: "# of beneficiaries" },
			            //{ title: "Location" },
			            { title: "Province" },
			            //{ title: "Implementation period (start)" },
			            { title: "Implementation_period" },
			            { title: "Implementing Partner"},
			            //{ title: "Remark" },
			            
			        ],
			        responsive: true,
			        
				    
			    } );
	    	}

	    	$('#regionselect').on('change',function(){
	    		var val = $(this).val();
	    		let select = val.replace('-',' ');
	    		regionselect = select;
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			if(val == 0){
		    			redrawvis(val);
		    		}else{
		    			redrawvis(select);

		    		}
	    			$('#loadinggif').hide();
	    		},500)
	    	})

	    	$('#periodselect').on('change',function(){
	    		$('#loadinggif').show();
	    		var val = $(this).val();
	    		periodselect = val;
	    		setTimeout(function(){
	    			redrawvisbasedonperiod(periodselect);
	    			$('#loadinggif').hide();
	    		},500)
	    	})

	    	$('#resetall').on('click',function(){
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			redrawvisbasedonperiod(0)
	    			$('#loadinggif').hide();
	    		},500)
	    	})

	    	function redrawvisbasedonperiod(theperiod){
	    		if(map.hasLayer(geojson)){
					map.removeLayer(geojson);
				}
				
	    		$('.info').remove();
	    		var therepper = 0;

    			agenciesCount = [];
    			statusCount = [];
				beneCount = [];
    			sectorCount = [];
    			provinceCount=[];
    			datatblnew = [];
    			orgtotal=[];
    			$('#regionselect').html('');
    			$('#regionselect').append('<option value="0">ALL Province</option>');

    			if(theperiod == 0){
    				reportingperiod = [];
    				$('#periodselect').html('');
	    			thedata.forEach(function(d){
	    				let repper = d['Reporting period'];
		    			if(!reportingperiod[repper]){
		    				reportingperiod[repper] = repper;
		    				therepper = repper;
		    				$('#periodselect').append('<option class="periodselect" selected="true" value="'+repper+'">'+repper+'</option>');
		    				$('#periodselect option[value="'+repper+'"]').prop("selected",true);
		    			}
		    			theperiod = therepper;
		    		});
    			}
    			
	    		thedata.forEach(function(d){
	    			if(d['Reporting period'] == theperiod){
	    				datatblnew.push(d);
	    				let tempat = d['Province'].toUpperCase();
		    			if(provinceCount[tempat]){
		    				provinceCount[tempat] += 1;
		    			}else{
		    				provinceCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}
		    			let orgtype = d['Type of Activity'].toUpperCase();
		    			if(agenciesCount[orgtype]){
		    				agenciesCount[orgtype] += 1;
		    			}else{
		    				agenciesCount[orgtype] = 1;
		    			}

		    			let stattype = d['Implementation_period'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

						let benetype = d['Type of beneficiaries'].toUpperCase();
		    			if(benetype!=''){
		    				if(beneCount[benetype]){
			    				beneCount[benetype] += 1;
			    			}else{
			    				beneCount[benetype] = 1;
			    			}
		    			}

		    			let sectortype = d['Sub Priority Area'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}

		    			let org=d['Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
		    		}
	    			
	    		})
	    		periodselect = theperiod;

	    		drawregiondiv();
				drawMapCircle();
	    		f_drawPieOrg();
	    		f_drawPieStat();
				f_drawPieBene();
	    		f_drawBarSect();
				f_drawIndicator();
	    		f_drawDataTable(datatblnew);

	    		let val3 = 0;
	    		let val2 = 0;
	    		for(x in provinceCount){
	    			val3++;
	    			val2+=provinceCount[x];
	    		}
	    		$('#val3').html(val3);
	    		$('#val2').html(val2);
	    		$('#val1').html(orgtotal.length);
	    	}

	    	function redrawvis(namaProvince){
	    		$('#loadinggif').show();
	    		map.removeLayer(geojson);
	    		$('.info').remove();

    			agenciesCount = [];
				beneCount = [];
    			statusCount = [];
    			sectorCount = [];
    			provinceCount=[];
    			datatblnew = [];
    			orgtotal=[];

	    		thedata.forEach(function(d){
	    			if(namaProvince == '0' && periodselect == d['Reporting period'] ){
	    				datatblnew.push(d);
	    				let tempat = d['Province'].toUpperCase();
		    			if(provinceCount[tempat]){
		    				provinceCount[tempat] += 1;
		    			}else{
		    				provinceCount[tempat] = 1;
		    				// let select = tempat.replace(' ','-');
		    				// $('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}

		    			let orgtype = d['Organisation Type'].toUpperCase();
		    			if(agenciesCount[orgtype]){
		    				agenciesCount[orgtype] += 1;
		    			}else{
		    				agenciesCount[orgtype] = 1;
		    			}

		    			let stattype = d['Implementation_period'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

						let benetype = d['Type of beneficiaries'].toUpperCase();
		    			if(benetype!=''){
		    				if(beneCount[benetype]){
			    				beneCount[benetype] += 1;
			    			}else{
			    				beneCount[benetype] = 1;
			    			}
		    			}

		    			let sectortype = d['Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}

		    			let org=d['Organization'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
	    			}
	    			else if(d['Province'].toUpperCase() == namaProvince.toUpperCase() && periodselect == d['Reporting period']){
	    				datatblnew.push(d);
	    				let tempat = d['Province'].toUpperCase();
		    			if(provinceCount[tempat]){
		    				provinceCount[tempat] += 1;
		    			}else{
		    				provinceCount[tempat] = 1;
		    				// let select = tempat.replace(' ','-');
		    				// $('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}
		    			let orgtype = d['Organisation Type'].toUpperCase();
		    			if(agenciesCount[orgtype]){
		    				agenciesCount[orgtype] += 1;
		    			}else{
		    				agenciesCount[orgtype] = 1;
		    			}

		    			let stattype = d['Implementation_period'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

						let benetype = d['Type of beneficiaries'].toUpperCase();
		    			if(benetype!=''){
		    				if(beneCount[benetype]){
			    				beneCount[benetype] += 1;
			    			}else{
			    				beneCount[benetype] = 1;
			    			}
		    			}

		    			let sectortype = d['Cluster'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}

		    			let org=d['Organization'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
		    			}
		    		}
	    			
	    		})

	    		drawregiondiv();
				drawMapCircle();
	    		f_drawPieOrg();
	    		f_drawPieStat();
				f_drawPieBene();
	    		f_drawBarSect();
				f_drawIndicator();
	    		f_drawDataTable(datatblnew);

	    		let val3 = 0;
	    		let val2 = 0;
	    		for(x in provinceCount){
	    			val3++;
	    			val2+=provinceCount[x];
	    		}
	    		$('#val3').html(val3);
	    		$('#val2').html(val2);
	    		$('#val1').html(orgtotal.length);
	    		$('#loadinggif').hide();
                
	    	}

	    	function redrawbasestat(stat){
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			run();
	    			$('#loadinggif').hide();
	    		},500)

	    		function run(){
	    			map.removeLayer(geojson);
		    		$('.info').remove();
		    		
		    		agenciesCount = [];
	    			datatblnew = [];
	    			provinceCount = [];
	    			orgtotal=[];
	    			sectorCount=[];

	    			console.log(periodselect);
	    			console.log(regionselect);

		    		thedata.forEach(function(d){
		    			if( d['Province'].toUpperCase() == regionselect){
		    				console.log(d['Province'].toUpperCase())
		    			}
		    			if(d['Implementation_period'].toUpperCase() == stat && d['Reporting period'] == periodselect && (regionselect == 0 || regionselect == d['Province'].toUpperCase()) ){
		    				datatblnew.push(d);
		    				let tempat = d['Province'].toUpperCase();
			    			if(provinceCount[tempat]){
			    				provinceCount[tempat] += 1;
			    			}else{
			    				provinceCount[tempat] = 1;
			    				let select = tempat.replace(' ','-');
			    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
			    			}

			    			let orgtype = d['Organisation Type'].toUpperCase();
			    			if(agenciesCount[orgtype]){
			    				agenciesCount[orgtype] += 1;
			    			}else{
			    				agenciesCount[orgtype] = 1;
			    			}

			    			let org=d['Organization'];
			    			let cek = $.inArray( org, orgtotal ); 
			    			if(cek == -1){
			    				orgtotal.push(org);
			    			}

			    			let sectortype = d['Cluster'].toUpperCase();
			    			if(sectorCount[sectortype]){
			    				sectorCount[sectortype] += 1;
			    			}else{
			    				sectorCount[sectortype] = 1;
			    			}
		    			}
		    		})

		    		drawregiondiv();
					drawMapCircle();
		    		f_drawPieOrg();
		    		f_drawDataTable(datatblnew);
		    		f_drawBarSect();

		    		let val3 = 0;
		    		let val2 = 0;
		    		for(x in provinceCount){
		    			val3++;
		    			val2+=provinceCount[x];
		    		}
		    		$('#val3').html(val3);
		    		$('#val2').html(val2);
		    		$('#val1').html(orgtotal.length);
	    		}
	    	}

	    	function redrawbaseorg(org){
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			run();
	    			$('#loadinggif').hide();
	    		},500)
	    		function run(){
	    			map.removeLayer(geojson);
		    		$('.info').remove();
		    		
	    			datatblnew = [];
	    			provinceCount = [];
	    			orgtotal=[];
	    			sectorCount=[];
	    			statusCount = [];
					beneCount = [],

		    		thedata.forEach(function(d){
		    			if(d['Organisation Type'].toUpperCase() == org && d['Reporting period'] == periodselect && (regionselect == 0 || regionselect == d['Province'].toUpperCase())){
		    				datatblnew.push(d);
		    				let tempat = d['Province'].toUpperCase();
			    			if(provinceCount[tempat]){
			    				provinceCount[tempat] += 1;
			    			}else{
			    				provinceCount[tempat] = 1;
			    				let select = tempat.replace(' ','-');
			    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
			    			}

			    			let org=d['Organization'];
			    			let cek = $.inArray( org, orgtotal ); 
			    			if(cek == -1){
			    				orgtotal.push(org);
			    			}

			    			let sectortype = d['Cluster'].toUpperCase();
			    			if(sectorCount[sectortype]){
			    				sectorCount[sectortype] += 1;
			    			}else{
			    				sectorCount[sectortype] = 1;
			    			}

			    			let stattype = d['Implementation_period'].toUpperCase();
			    			if(stattype!=''){
			    				if(statusCount[stattype]){
				    				statusCount[stattype] += 1;
				    			}else{
				    				statusCount[stattype] = 1;
				    			}
			    			}

							let benetype = d['Type of beneficiaries'].toUpperCase();
			    			if(benetype!=''){
			    				if(beneCount[benetype]){
				    				beneCount[benetype] += 1;
				    			}else{
				    				beneCount[benetype] = 1;
				    			}
			    			}
		    			}
		    		})

		    		drawregiondiv();
					drawMapCircle();
		    		f_drawDataTable(datatblnew);
		    		f_drawBarSect();
		    		f_drawPieStat();

		    		let val3 = 0;
		    		let val2 = 0;
		    		for(x in provinceCount){
		    			val3++;
		    			val2+=provinceCount[x];
		    		}
		    		$('#val3').html(val3);
		    		$('#val2').html(val2);
		    		$('#val1').html(orgtotal.length);
	    		}
	    	}

	    	function redrawbasesector(sector){
	    		$('#loadinggif').show();
	    		setTimeout(function(){
	    			run();
	    			$('#loadinggif').hide();
	    		},500)
	    		function run(){
	    			map.removeLayer(geojson);
		    		$('.info').remove();
		    		
		    		agenciesCount = [];
	    			statusCount = [];
					beneCount = [];
	    			datatblnew = [];
	    			provinceCount = [];
	    			orgtotal=[];

		    		thedata.forEach(function(d){
		    			if(d['Cluster'].toUpperCase() == sector && d['Reporting period'] == periodselect && (regionselect == 0 || regionselect == d['Province'].toUpperCase())){
		    				datatblnew.push(d);
		    				let tempat = d['Province'].toUpperCase();
			    			if(provinceCount[tempat]){
			    				provinceCount[tempat] += 1;
			    			}else{
			    				provinceCount[tempat] = 1;
			    				let select = tempat.replace(' ','-');
			    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
			    			}


			    			let orgtype = d['Organisation Type'].toUpperCase();
			    			if(agenciesCount[orgtype]){
			    				agenciesCount[orgtype] += 1;
			    			}else{
			    				agenciesCount[orgtype] = 1;
			    			}

			    			let stattype = d['Implementation_period'].toUpperCase();
			    			if(stattype!=''){
			    				if(statusCount[stattype]){
				    				statusCount[stattype] += 1;
				    			}else{
				    				statusCount[stattype] = 1;
				    			}
			    			}

							let benetype = d['Type of beneficiaries'].toUpperCase();
			    			if(benetype!=''){
			    				if(beneCount[benetype]){
				    				beneCount[benetype] += 1;
				    			}else{
				    				beneCount[benetype] = 1;
				    			}
			    			}

			    			let org=d['Organization'];
			    			let cek = $.inArray( org, orgtotal ); 
			    			if(cek == -1){
			    				orgtotal.push(org);
			    			}
		    			}
		    		})

		    		drawregiondiv();
					drawMapCircle();
		    		f_drawPieOrg();
		    		f_drawPieStat();
					f_drawPieBene();
		    		f_drawDataTable(datatblnew);

		    		let val3 = 0;
		    		let val2 = 0;
		    		for(x in provinceCount){
		    			val3++;
		    			val2+=provinceCount[x];
		    		}
		    		$('#val3').html(val3);
		    		$('#val2').html(val2);
		    		$('#val1').html(orgtotal.length);
	    		}
	    	}


            function drawBubbleChart(dataSeries,max){
                Highcharts.chart('bubblechart', {
                    chart: {
                        type: 'packedbubble',
                        height: 350,
                    },
                    credits: {
                        enabled: false
                    },
                    colors: ['#157A72', '#1B9D93', '#20BFB3', '#48CAC0', '#85DCD5'],
                    title: {
                        text: '',
                        margin: -10,
                    },
                    tooltip: {
                        useHTML: true,
                        pointFormat: '<b>{point.name}:</b> {point.value}'
                    },
                    legend:{
                        enabled: false,
                    },
                    plotOptions: {
                        packedbubble: {
                            opacity: 1,
                            findNearestPointBy:'x',
                            minSize: '40%',
                            maxSize: '150%',
                            zMin: 1,
                            zMax: max,
                            layoutAlgorithm: {
                                splitSeries: false,
                                gravitationalConstant: 0.02,
                                maxIterations:500
                            },
                            dataLabels: {
                                enabled: true,
                                format: '{point.name}',
                                filter: {
                                    property: 'y',
                                    operator: '>',
                                    value: 1
                                },
                                style: {
                                    color: 'black',
                                    textOutline: 'none',
                                    fontWeight: 'normal'
                                }
                            }
                        }
                    },
                    series: dataSeries
                });

            }

	    	function drawinit(){
	    		orgtotal=[];
                orgval = [];
	    		var therepper = 0;
	    		thedata.forEach(function(d){
		    			let tempat = d['Province'].toUpperCase();
		    			if(provinceCount[tempat]){
		    				provinceCount[tempat] += 1;
		    			}else{
		    				provinceCount[tempat] = 1;
		    				let select = tempat.replace(' ','-');
		    				$('#regionselect').append('<option value="'+select+'">'+tempat+'</option>');
		    			}

		    			let repper = d['Reporting period'];
		    			if(!reportingperiod[repper]){
		    				reportingperiod[repper] = repper;
		    				therepper = repper;
		    				$('#periodselect').append('<option class="periodselect" selected="true" value="'+repper+'">'+repper+'</option>');
		    				$('#periodselect option[value="'+repper+'"]').prop("selected",true);
		    			}

		    			let benetype = d['Type of beneficiaries'].toUpperCase();
		    			if(beneCount[benetype]){
		    				beneCount[benetype] += 1;
		    			}else{
		    				beneCount[benetype] = 1;
		    			}

		    			let stattype = d['Implementation_period'].toUpperCase();
		    			if(stattype!=''){
		    				if(statusCount[stattype]){
			    				statusCount[stattype] += 1;
			    			}else{
			    				statusCount[stattype] = 1;
			    			}
		    			}

		    			let sectortype = d['Sub Priority Area'].toUpperCase();
		    			if(sectorCount[sectortype]){
		    				sectorCount[sectortype] += 1;
		    			}else{
		    				sectorCount[sectortype] = 1;
		    			}
		    			
		    			
		    			let org=d['Agency'];
		    			let cek = $.inArray( org, orgtotal ); 
		    			if(cek == -1){
		    				orgtotal.push(org);
                            orgval[org] = 1;
		    			}else{
                            orgval[org] += 1
                        }
		    	});

                let bubbleData = [];
                // ['#157A72', '#1B9D93', '#20BFB3', '#48CAC0', '#85DCD5']
                for(x in orgval){
                    let color = '#85DCD5';
                  
                    if(orgval[x] >= 10){
                        color = '#034540';
                    }
                    else if(orgval[x] >= 5){
                        color = '#157A72';
                    }else if(orgval[x] >= 4){
                        color = '#1B9D93';
                    }else if(orgval[x] >= 3){
                        color = '#20BFB3';
                    }else if(orgval[x] >= 2){
                        color = '#48CAC0';
                    }else if(orgval[x] >= 1){
                        color = '#85DCD5';
                    }

                    bubbleData.push({
                        name: x,
                        color: color,
                        data: [
                            {
                                name: x,
                                value: orgval[x]
                            }]
                        });
                }
                bubbleData = bubbleData.sort(function(a,b){
                    return a.data[0].value > b.data[0].value ? -1 : 1;
                })


                drawregiondiv();
				drawMapCircle();
                // f_drawPieOrg();
                // f_drawPieStat();
                // f_drawBarSect();
                // f_drawDataTable(thedata);
                periodselect = therepper;
                redrawvisbasedonperiod(therepper)

                let val3 = 0;
                let val2 = 0;
                for(x in provinceCount){
                    val3++;
                    val2+=provinceCount[x];
                }
                $('#val3').html(val3);
                $('#val2').html(val2);
                $('#val1').html(orgtotal.length);

                drawboundaries();
                drawBubbleChart(bubbleData,bubbleData[0].data[0].value);
	    	}

	    	$('#loadinggif').show();
			d3.json('indonesia-adm-1.geojson').then(function(jso){
				statesData = jso;
				//call the original data
	    		d3.csv('./data/health_msrp_data.csv').then(function(data){
		    		//set the data called to variable thedata
		    		thedata = data;
		    		drawinit();
		    		$('#loadinggif').hide();
		    	})	    	
			})
		    


    	})
    	
    </script>


  </body>

</html>
